# APK打包详细教程 📱

## 🛠️ 环境准备

### Windows环境下打包

1. **安装Python 3.8+**
   - 从 https://python.org 下载并安装Python
   - 确保勾选"Add to PATH"选项

2. **安装依赖包**
   ```bash
   pip install buildozer
   pip install -r requirements.txt
   ```

3. **安装Android开发环境**
   - 下载并安装 Android Studio
   - 配置Android SDK和NDK
   - 设置环境变量

### Linux环境下打包（推荐）

如果Windows环境配置困难，建议使用Linux虚拟机或WSL：

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3-pip git zip unzip openjdk-8-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev

# 安装buildozer
pip3 install buildozer

# 克隆项目并构建
git clone <你的项目地址>
cd pack
buildozer android debug
```

## 📦 打包步骤

### 方法一：本地打包

1. **进入项目目录**
   ```bash
   cd F:\cursor\files\pack
   ```

2. **初始化buildozer（首次运行）**
   ```bash
   buildozer init
   ```

3. **构建APK**
   ```bash
   # 调试版本
   buildozer android debug
   
   # 发布版本（需要签名）
   buildozer android release
   ```

4. **等待构建完成**
   - 首次构建会下载Android SDK/NDK，需要较长时间
   - 构建完成后，APK在 `bin/` 目录下

### 方法二：云端打包（简单快捷）

如果本地环境配置困难，可以使用在线服务：

#### 使用GitHub Actions

1. **上传代码到GitHub**
   ```bash
   git init
   git add .
   git commit -m "每日关怀APP"
   git remote add origin <你的GitHub仓库地址>
   git push -u origin main
   ```

2. **创建GitHub Actions工作流**
   
   创建 `.github/workflows/build.yml`：
   ```yaml
   name: Build APK
   
   on:
     push:
       branches: [ main ]
     pull_request:
       branches: [ main ]
   
   jobs:
     build:
       runs-on: ubuntu-latest
       
       steps:
       - uses: actions/checkout@v3
       
       - name: Set up Python
         uses: actions/setup-python@v3
         with:
           python-version: '3.8'
           
       - name: Install dependencies
         run: |
           sudo apt-get update
           sudo apt-get install -y git zip unzip openjdk-8-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
           pip install buildozer
           
       - name: Build APK
         run: |
           buildozer android debug
           
       - name: Upload APK
         uses: actions/upload-artifact@v3
         with:
           name: app-debug
           path: bin/*.apk
   ```

3. **推送代码触发构建**
   ```bash
   git add .
   git commit -m "添加自动构建"
   git push
   ```

4. **下载构建好的APK**
   - 在GitHub仓库的Actions页面查看构建状态
   - 构建完成后下载APK文件

## 🔧 常见问题解决

### 问题1：Java版本不兼容
```bash
# 安装Java 8
sudo apt install openjdk-8-jdk
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
```

### 问题2：NDK下载失败
```bash
# 手动指定NDK版本
buildozer android debug --verbose
```

### 问题3：编译错误
```bash
# 清理缓存重新构建
buildozer android clean
buildozer android debug
```

### 问题4：权限问题
```bash
# 给buildozer执行权限
chmod +x ~/.buildozer/android/platform/android-ndk-*/build/tools/make_standalone_toolchain.py
```

## 📱 APK安装说明

### 给妈妈的安装步骤：

1. **接收APK文件**
   - 通过微信、QQ或邮件接收APK文件
   - 保存到手机存储中

2. **允许安装未知来源应用**
   - 打开手机"设置"
   - 找到"安全"或"应用管理"
   - 开启"未知来源"或"允许安装未知应用"

3. **安装应用**
   - 点击APK文件
   - 按提示完成安装
   - 在桌面找到"每日关怀"图标

4. **首次使用**
   - 点击应用图标打开
   - 允许必要的权限（网络访问等）
   - 开始使用各项功能

## 🎯 优化建议

### 减小APK体积
```python
# 在buildozer.spec中添加：
android.add_compile_options = --enable-site-packages
requirements = python3,kivy==2.1.0
```

### 添加应用图标
1. 准备512x512像素的PNG图标
2. 命名为 `icon.png` 放在项目根目录
3. 在 `buildozer.spec` 中取消注释：
   ```
   icon.filename = %(source.dir)s/icon.png
   ```

### 添加启动画面
1. 准备适当尺寸的启动画面图片
2. 命名为 `presplash.png`
3. 在 `buildozer.spec` 中配置

## 💡 进阶功能

### 应用签名（发布版本）
```bash
# 生成密钥
keytool -genkey -v -keystore debug.keystore -alias mydebugkey -keyalg RSA -keysize 2048 -validity 10000

# 在buildozer.spec中配置
android.keystore = %(source.dir)s/debug.keystore
android.keystore_pass = 你的密码
android.key_pass = 你的密码
android.key_alias = mydebugkey
```

### 多架构支持
```
# 在buildozer.spec中配置
android.archs = arm64-v8a, armeabi-v7a, x86_64
```

## 📞 技术支持

如果在打包过程中遇到问题：

1. 检查Python和依赖版本
2. 查看buildozer详细日志
3. 参考Kivy官方文档
4. 搜索相关错误信息

记住：编程不仅仅是写代码，更是解决问题的过程。每一个错误都是学习的机会！

---

*祝你成功打包出第一个APP，让妈妈为你骄傲！* 🎉
